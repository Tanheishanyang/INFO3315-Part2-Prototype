<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Food Delivery App Prototype</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <style>
:root {
  --color-bg: #f2f6f3;
  --color-surface: #ffffff;
  --color-surface-alt: #e7f1eb;
  --color-primary: #2d7a56;
  --color-primary-light: #57b287;
  --color-accent: #4aa86b;
  --color-text: #1f2a24;
  --color-muted: #5a6c60;
  --color-border: #d5e0d8;
  --shadow-sm: 0 6px 18px rgba(41, 71, 54, 0.08);
  --radius-lg: 20px;
  --radius-md: 14px;
  --radius-sm: 8px;
  --transition: 0.2s ease;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: var(--color-text);
  background: var(--color-bg);
  line-height: 1.6;
}

img {
  max-width: 100%;
  display: block;
}

a {
  color: inherit;
}

button,
input,
select,
textarea {
  font: inherit;
  color: inherit;
}

button {
  cursor: pointer;
}

button:disabled {
  cursor: not-allowed;
}

.top-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  background: var(--color-surface);
  box-shadow: var(--shadow-sm);
  position: sticky;
  top: 0;
  z-index: 100;
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
}

.brand span {
  font-size: 1.75rem;
}

.brand-name {
  font-weight: 700;
  margin: 0;
}

.brand-tagline {
  margin: 2px 0 0;
  color: var(--color-muted);
  font-size: 0.85rem;
}

.main-nav {
  display: flex;
  overflow-x: auto;
  gap: 8px;
  padding-bottom: 4px;
}

.main-nav::-webkit-scrollbar {
  display: none;
}

.nav-btn {
  border: 1px solid var(--color-border);
  background: var(--color-surface);
  color: var(--color-muted);
  padding: 10px 18px;
  border-radius: 999px;
  font-weight: 600;
  transition: var(--transition);
  white-space: nowrap;
}

.nav-btn:hover,
.nav-btn:focus-visible {
  border-color: var(--color-primary-light);
  color: var(--color-primary);
}

.nav-btn.active {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: #ffffff;
}

main {
  padding: 0 20px 80px;
}

.view {
  display: block;
  margin: 28px auto;
  max-width: 1080px;
}

.view[hidden] {
  display: none !important;
}

.view-header h1 {
  margin: 0 0 6px;
  font-size: 1.7rem;
}

.view-instruction {
  margin: 0;
  color: var(--color-muted);
  font-size: 0.95rem;
}

.filter-panel {
  display: grid;
  gap: 16px;
  margin: 24px 0 32px;
  padding: 20px;
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
}

.field,
.field-group {
  display: flex;
  gap: 12px;
  flex-direction: column;
}

.field label {
  font-weight: 600;
}

.field input,
.field select,
.field textarea {
  padding: 12px;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: #ffffff;
  transition: border-color var(--transition);
}

.field input:focus-visible,
.field select:focus-visible,
.field textarea:focus-visible {
  border-color: var(--color-primary);
  outline: none;
  box-shadow: 0 0 0 3px rgba(87, 178, 135, 0.24);
}

.field textarea {
  resize: vertical;
}

.output {
  font-weight: 600;
}

.toggles {
  flex-direction: row;
  gap: 20px;
  flex-wrap: wrap;
}

.toggle {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

.toggle input {
  width: 18px;
  height: 18px;
  accent-color: var(--color-primary);
}

.section-title {
  margin: 0 0 4px;
  font-size: 1.2rem;
}

.section-subtitle {
  margin: 0 0 20px;
  color: var(--color-muted);
  font-size: 0.95rem;
}

.supplier-grid {
  display: grid;
  gap: 18px;
}

.supplier-card {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  display: grid;
  gap: 14px;
  transition: transform var(--transition), box-shadow var(--transition);
}

.supplier-card:hover,
.supplier-card:focus-within {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(45, 122, 86, 0.16);
}

.supplier-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.supplier-name {
  font-size: 1.2rem;
  margin: 0;
}

.supplier-location {
  margin: 4px 0 0;
  color: var(--color-muted);
  font-size: 0.9rem;
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 0.8rem;
  font-weight: 600;
  background: var(--color-surface-alt);
  color: var(--color-primary);
}

.supplier-meta {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  font-size: 0.9rem;
  color: var(--color-muted);
}

.hamper-summary {
  background: var(--color-surface-alt);
  border-radius: var(--radius-md);
  padding: 16px;
  display: grid;
  gap: 6px;
}

.hamper-summary h4 {
  margin: 0;
}

.hamper-summary p {
  margin: 0;
  color: var(--color-muted);
  font-size: 0.9rem;
}

.supplier-footnote {
  margin: 0;
  font-size: 0.85rem;
  color: var(--color-muted);
}

.action-row {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.primary-btn,
.secondary-btn,
.ghost-btn {
  border-radius: 999px;
  padding: 10px 20px;
  font-weight: 600;
  border: none;
  transition: var(--transition);
}

.primary-btn {
  background: var(--color-primary);
  color: #ffffff;
}

.primary-btn:hover,
.primary-btn:focus-visible {
  background: var(--color-primary-light);
}

.secondary-btn {
  background: var(--color-surface-alt);
  color: var(--color-primary);
}

.secondary-btn:hover,
.secondary-btn:focus-visible {
  background: rgba(87, 178, 135, 0.26);
}

.ghost-btn {
  background: transparent;
  border: 1px solid var(--color-border);
}

.ghost-btn:hover,
.ghost-btn:focus-visible {
  border-color: var(--color-primary-light);
  color: var(--color-primary);
}

.compare-panel {
  margin: 24px 0;
  display: grid;
  gap: 20px;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

.comparison-table-container {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  overflow-x: auto;
}

.comparison-table {
  width: 100%;
  border-collapse: collapse;
}

.comparison-table th,
.comparison-table td {
  padding: 14px 20px;
  text-align: left;
  border-bottom: 1px solid var(--color-border);
}

.comparison-table tbody tr:last-child th,
.comparison-table tbody tr:last-child td {
  border-bottom: none;
}

.checkout-layout {
  display: grid;
  gap: 24px;
}

.cart,
.checkout-details {
  background: var(--color-surface);
  padding: 24px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
}

.cart h2,
.checkout-details h2 {
  margin-top: 0;
}

.cart-list {
  list-style: none;
  padding: 0;
  margin: 0 0 18px;
  display: grid;
  gap: 16px;
}

.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  background: var(--color-surface-alt);
  border-radius: var(--radius-md);
  padding: 14px 16px;
}

.cart-item-info {
  display: grid;
  gap: 4px;
}

.cart-item-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.cart-total {
  display: flex;
  justify-content: space-between;
  font-size: 1.1rem;
  font-weight: 700;
}

.empty-state {
  margin: 12px 0;
  color: var(--color-muted);
}

.order-status {
  min-height: 24px;
  margin-top: 12px;
  font-weight: 600;
  color: var(--color-primary);
}

.tracking-card {
  background: var(--color-surface);
  padding: 24px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  display: grid;
  gap: 20px;
}

.map-placeholder {
  height: 180px;
  border-radius: var(--radius-md);
  background: linear-gradient(135deg, rgba(45, 122, 86, 0.18), rgba(87, 178, 135, 0.4));
  position: relative;
}

.map-placeholder::after {
  content: '';
  position: absolute;
  inset: 26px;
  border: 2px dashed rgba(255, 255, 255, 0.6);
  border-radius: var(--radius-md);
}

.tracking-steps {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 12px;
}

.tracking-step {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 18px;
  border-radius: var(--radius-md);
  background: var(--color-surface-alt);
  color: var(--color-muted);
  transition: var(--transition);
}

.tracking-detail {
  font-size: 0.9rem;
}

.tracking-step.active {
  background: rgba(87, 178, 135, 0.18);
  color: var(--color-primary);
  font-weight: 600;
}

.progress-bar {
  height: 8px;
  border-radius: 999px;
  background: rgba(45, 122, 86, 0.16);
  overflow: hidden;
}

.progress-indicator {
  height: 100%;
  width: 0;
  background: var(--color-primary);
  transition: width 0.4s ease;
}

.report-grid {
  display: grid;
  gap: 20px;
}

.report-card {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: 24px;
  box-shadow: var(--shadow-sm);
  display: grid;
  gap: 8px;
}

.report-card h2 {
  margin: 0;
}

.report-value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--color-primary);
  margin: 0;
}

.report-detail {
  margin: 0;
  color: var(--color-muted);
}

.app-footer {
  padding: 24px 20px;
  text-align: center;
  color: var(--color-muted);
  font-size: 0.85rem;
}

.nav-btn:focus-visible,
.primary-btn:focus-visible,
.secondary-btn:focus-visible,
.ghost-btn:focus-visible,
.supplier-card:focus-visible,
#reset-tracking:focus-visible {
  outline: 3px solid rgba(87, 178, 135, 0.6);
  outline-offset: 2px;
}

@media (min-width: 720px) {
  .filter-panel {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .field-group {
    flex-direction: row;
    align-items: flex-end;
  }

  .field-group .field {
    flex: 1;
  }
}

@media (min-width: 960px) {
  .supplier-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .checkout-layout {
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
    align-items: start;
  }

  .report-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}

</style>
  </head>
  <body>
    <header class="top-bar">
      <div class="brand">
        <span aria-hidden="true">&#129379;</span>
        <div>
          <p class="brand-name">Smart Food Delivery</p>
          <p class="brand-tagline">Sustainable meals for remote communities</p>
        </div>
      </div>
      <nav class="main-nav" aria-label="Primary">
        <button class="nav-btn" data-target="home-view">Search</button>
        <button class="nav-btn" data-target="compare-view">Compare</button>
        <button class="nav-btn" data-target="checkout-view">Checkout</button>
        <button class="nav-btn" data-target="tracking-view">Tracking</button>
        <button class="nav-btn" data-target="report-view">Report</button>
      </nav>
    </header>

    <main id="app" tabindex="-1">
      <section id="home-view" class="view active" aria-labelledby="home-title">
        <header class="view-header">
          <h1 id="home-title">Find nearby food suppliers</h1>
          <p class="view-instruction">Task 1: Use the filters to locate affordable, low-carbon options that deliver to your area.</p>
        </header>

        <form id="filter-form" class="filter-panel" aria-label="Search filters">
          <div class="field">
            <label for="search-input">Search by name or location</label>
            <input id="search-input" type="search" placeholder="Try 'Outback' or 'Remote'" />
          </div>

          <div class="field-group">
            <div class="field">
              <label for="price-filter">Price band</label>
              <select id="price-filter">
                <option value="all">Any</option>
                <option value="$">$ - Lowest cost</option>
                <option value="$$">$$ - Balanced</option>
                <option value="$$$">$$$ - Premium</option>
              </select>
            </div>

            <div class="field">
              <label for="distance-filter">Max distance (km)</label>
              <input id="distance-filter" type="range" min="5" max="60" value="40" step="5" />
              <output id="distance-output" for="distance-filter">40 km</output>
            </div>
          </div>

          <div class="field toggles">
            <label class="toggle">
              <input id="surplus-toggle" type="checkbox" />
              <span>Show surplus food offers only</span>
            </label>
            <label class="toggle">
              <input id="delivery-toggle" type="checkbox" checked />
              <span>Delivery available</span>
            </label>
          </div>
        </form>

        <section aria-live="polite" aria-atomic="true">
          <h2 class="section-title">Suppliers near you</h2>
          <p class="section-subtitle">Tap a card to compare or add a community hamper to your cart.</p>
          <div id="supplier-grid" class="supplier-grid"></div>
        </section>
      </section>

      <section id="compare-view" class="view" aria-labelledby="compare-title" hidden>
        <header class="view-header">
          <h1 id="compare-title">Compare suppliers</h1>
          <p class="view-instruction">Task 2: Choose two suppliers to see how they differ in freshness, price, and emissions.</p>
        </header>

        <div class="compare-panel">
          <div class="field">
            <label for="compare-a">Supplier A</label>
            <select id="compare-a"></select>
          </div>
          <div class="field">
            <label for="compare-b">Supplier B</label>
            <select id="compare-b"></select>
          </div>
        </div>

        <div class="comparison-table-container">
          <table class="comparison-table" aria-describedby="compare-title">
            <thead>
              <tr>
                <th scope="col">Metric</th>
                <th scope="col" id="compare-name-a">Supplier A</th>
                <th scope="col" id="compare-name-b">Supplier B</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Price</th>
                <td data-metric="price-a"></td>
                <td data-metric="price-b"></td>
              </tr>
              <tr>
                <th scope="row">Freshness score</th>
                <td data-metric="freshness-a"></td>
                <td data-metric="freshness-b"></td>
              </tr>
              <tr>
                <th scope="row">Delivery CO2 impact</th>
                <td data-metric="co2-a"></td>
                <td data-metric="co2-b"></td>
              </tr>
              <tr>
                <th scope="row">Distance</th>
                <td data-metric="distance-a"></td>
                <td data-metric="distance-b"></td>
              </tr>
              <tr>
                <th scope="row">Surplus food</th>
                <td data-metric="surplus-a"></td>
                <td data-metric="surplus-b"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="checkout-view" class="view" aria-labelledby="checkout-title" hidden>
        <header class="view-header">
          <h1 id="checkout-title">Review and place your order</h1>
          <p class="view-instruction">Task 3: Confirm the items in your hamper, then place the order to start tracking.</p>
        </header>

        <div class="checkout-layout">
          <section class="cart" aria-label="Cart contents">
            <h2>Cart summary</h2>
            <ul id="cart-list" class="cart-list"></ul>
            <p id="cart-empty" class="empty-state">Your hamper is empty. Add items from the search view.</p>
            <div class="cart-total">
              <span>Total</span>
              <strong id="cart-total">$0.00</strong>
            </div>
          </section>

          <section class="checkout-details" aria-label="Delivery preferences">
            <h2>Delivery preferences</h2>
            <div class="field">
              <label for="delivery-window">Delivery window</label>
              <select id="delivery-window">
                <option value="11:00 - 13:00">11:00 - 13:00</option>
                <option value="13:00 - 15:00">13:00 - 15:00</option>
                <option value="17:00 - 19:00">17:00 - 19:00</option>
              </select>
            </div>

            <div class="field">
              <label for="contact-note">Driver note</label>
              <textarea id="contact-note" rows="3" placeholder="Add directions or access notes"></textarea>
            </div>

            <button id="place-order" class="primary-btn" type="button" disabled>Place order</button>
            <p id="order-status" class="order-status" role="status" aria-live="polite"></p>
            <button id="go-to-tracking" class="secondary-btn" type="button" hidden>Go to tracking</button>
          </section>
        </div>
      </section>

      <section id="tracking-view" class="view" aria-labelledby="tracking-title" hidden>
        <header class="view-header">
          <h1 id="tracking-title">Track your delivery</h1>
          <p class="view-instruction">Task 3 (continued): Follow the delivery stages to monitor when food arrives.</p>
        </header>

        <section class="tracking-card" aria-live="polite">
          <div class="map-placeholder" role="img" aria-label="Stylised delivery map with highlighted route"></div>
          <ol class="tracking-steps" id="tracking-steps"></ol>
          <div class="progress-bar" aria-hidden="true">
            <div id="progress-indicator" class="progress-indicator"></div>
          </div>
          <button id="reset-tracking" class="secondary-btn" type="button">Restart tracking demo</button>
        </section>
      </section>

      <section id="report-view" class="view" aria-labelledby="report-title" hidden>
        <header class="view-header">
          <h1 id="report-title">Savings & sustainability report</h1>
          <p class="view-instruction">Optional Task: Review your impact after ordering surplus community hampers.</p>
        </header>

        <div class="report-grid">
          <article class="report-card">
            <h2>Money saved</h2>
            <p class="report-value" id="report-savings">$0.00</p>
            <p class="report-detail">Compared to standard metropolitan deliveries.</p>
          </article>
          <article class="report-card">
            <h2>CO2 avoided</h2>
            <p class="report-value" id="report-co2">0.0 kg</p>
            <p class="report-detail">Estimated from lower delivery distances and surplus rescue.</p>
          </article>
          <article class="report-card">
            <h2>Meals rescued</h2>
            <p class="report-value" id="report-meals">0</p>
            <p class="report-detail">Surplus portions diverted from waste this month.</p>
          </article>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <p>INFO3315 Smart Food Delivery Prototype &middot; Designed for remote community resilience</p>
    </footer>

    <script>
const suppliers = [
  {
    id: 'outback-grocer',
    name: 'Outback Grocer',
    location: 'Alice Springs, NT',
    price: '$',
    averageBasket: 24.5,
    distance: 12,
    surplus: true,
    delivery: true,
    co2: 8,
    freshness: 8,
    description: 'Family-run grocer partnering with remote community hubs for surplus distribution.',
    items: [
      {
        id: 'outback-hamper',
        name: 'Remote Essentials Hamper',
        price: 24.5,
        servings: 4,
        savings: 12,
        co2Saved: 2.1,
        meals: 4,
        notes: 'Staples rescued from metro surplus: oats, long-life milk, bush herbs, seasonal produce.'
      }
    ]
  },
  {
    id: 'green-market',
    name: 'Green Market',
    location: 'Broken Hill, NSW',
    price: '$$',
    averageBasket: 32.0,
    distance: 5,
    surplus: false,
    delivery: true,
    co2: 6,
    freshness: 9,
    description: 'Hydroponic growers delivering weekly produce boxes using solar-powered vans.',
    items: [
      {
        id: 'green-harvest',
        name: 'Hydro Harvest Pack',
        price: 32,
        servings: 5,
        savings: 8,
        co2Saved: 1.3,
        meals: 5,
        notes: 'Leafy greens, tomatoes, and herbs grown with recycled water.'
      }
    ]
  },
  {
    id: 'remote-foods',
    name: 'Remote Foods',
    location: 'Katherine, NT',
    price: '$',
    averageBasket: 22.0,
    distance: 30,
    surplus: true,
    delivery: true,
    co2: 5,
    freshness: 7,
    description: 'Community co-op aggregating surplus produce from regional farms.',
    items: [
      {
        id: 'remote-hamper',
        name: 'Community Pantry Box',
        price: 22,
        servings: 3,
        savings: 9,
        co2Saved: 2.5,
        meals: 3,
        notes: 'Tinned beans, root vegetables, fresh bread, and pantry staples.'
      }
    ]
  },
  {
    id: 'bush-bites',
    name: 'Bush Bites Collective',
    location: 'Dubbo, NSW',
    price: '$$',
    averageBasket: 29.5,
    distance: 18,
    surplus: true,
    delivery: true,
    co2: 7,
    freshness: 8,
    description: 'Aboriginal-owned collective sharing culturally significant produce and meals.',
    items: [
      {
        id: 'bush-share',
        name: 'Bush Tucker Share Pack',
        price: 29.5,
        servings: 4,
        savings: 10,
        co2Saved: 1.9,
        meals: 4,
        notes: 'Kangaroo stew, lemon myrtle damper, native greens, and seasonal fruit.'
      }
    ]
  },
  {
    id: 'sunrise-co',
    name: 'Sunrise Co-Op',
    location: 'Longreach, QLD',
    price: '$$$',
    averageBasket: 38.0,
    distance: 22,
    surplus: false,
    delivery: true,
    co2: 9,
    freshness: 9,
    description: 'Solar chilled trucks delivering protein-rich hampers to cattle stations.',
    items: [
      {
        id: 'sunrise-protein',
        name: 'Protein Boost Crate',
        price: 38,
        servings: 6,
        savings: 5,
        co2Saved: 0.8,
        meals: 6,
        notes: 'Free-range eggs, legumes, yoghurt, and seasonal fruit.'
      }
    ]
  }
];

const trackingStages = [
  {
    id: 'preparing',
    title: 'Preparing hamper',
    detail: 'Volunteers are sorting surplus produce and packing your box.'
  },
  {
    id: 'driver',
    title: 'Driver assigned',
    detail: 'Jade (EV van) is collecting items from the supplier hub.'
  },
  {
    id: 'enroute',
    title: 'On the way',
    detail: 'Shared route to your community hub. 2.4 km remaining.'
  },
  {
    id: 'delivered',
    title: 'Delivered',
    detail: 'Hamper left in the community cool locker. Enjoy!'
  }
];

const state = {
  activeView: 'home-view',
  cart: [],
  trackingTimer: null,
  trackingIndex: 0,
  orderPlaced: false,
  totals: {
    savings: 0,
    co2Saved: 0,
    meals: 0
  }
};

const elements = {};

function init() {
  cacheElements();
  bindNavigation();
  bindFilters();
  bindCheckout();
  bindTrackingControls();
  renderSupplierFilters();
  renderSuppliers(suppliers);
  populateComparisonSelectors();
  updateComparison();
  updateCartUI();
  renderTrackingSteps();
  updateTrackingUI();
  switchView(state.activeView);
}

document.addEventListener('DOMContentLoaded', init);

function cacheElements() {
  elements.app = document.getElementById('app');
  elements.navButtons = Array.from(document.querySelectorAll('.nav-btn'));
  elements.views = Array.from(document.querySelectorAll('.view'));

  elements.searchInput = document.getElementById('search-input');
  elements.priceFilter = document.getElementById('price-filter');
  elements.distanceFilter = document.getElementById('distance-filter');
  elements.distanceOutput = document.getElementById('distance-output');
  elements.surplusToggle = document.getElementById('surplus-toggle');
  elements.deliveryToggle = document.getElementById('delivery-toggle');
  elements.supplierGrid = document.getElementById('supplier-grid');

  elements.compareA = document.getElementById('compare-a');
  elements.compareB = document.getElementById('compare-b');
  elements.compareNameA = document.getElementById('compare-name-a');
  elements.compareNameB = document.getElementById('compare-name-b');
  elements.compareMetrics = {
    priceA: document.querySelector('[data-metric="price-a"]'),
    priceB: document.querySelector('[data-metric="price-b"]'),
    freshnessA: document.querySelector('[data-metric="freshness-a"]'),
    freshnessB: document.querySelector('[data-metric="freshness-b"]'),
    co2A: document.querySelector('[data-metric="co2-a"]'),
    co2B: document.querySelector('[data-metric="co2-b"]'),
    distanceA: document.querySelector('[data-metric="distance-a"]'),
    distanceB: document.querySelector('[data-metric="distance-b"]'),
    surplusA: document.querySelector('[data-metric="surplus-a"]'),
    surplusB: document.querySelector('[data-metric="surplus-b"]')
  };

  elements.cartList = document.getElementById('cart-list');
  elements.cartEmpty = document.getElementById('cart-empty');
  elements.cartTotal = document.getElementById('cart-total');
  elements.placeOrder = document.getElementById('place-order');
  elements.orderStatus = document.getElementById('order-status');
  elements.goToTracking = document.getElementById('go-to-tracking');

  elements.reportSavings = document.getElementById('report-savings');
  elements.reportCo2 = document.getElementById('report-co2');
  elements.reportMeals = document.getElementById('report-meals');

  elements.trackingSteps = document.getElementById('tracking-steps');
  elements.progressIndicator = document.getElementById('progress-indicator');
  elements.resetTracking = document.getElementById('reset-tracking');
}

function bindNavigation() {
  elements.navButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const target = button.dataset.target;
      switchView(target);
    });
  });
}

function bindFilters() {
  elements.searchInput.addEventListener('input', handleFilterChange);
  elements.priceFilter.addEventListener('change', handleFilterChange);
  elements.distanceFilter.addEventListener('input', (event) => {
    const value = Number(event.target.value);
    elements.distanceOutput.textContent = `${value} km`;
    handleFilterChange();
  });
  elements.surplusToggle.addEventListener('change', handleFilterChange);
  elements.deliveryToggle.addEventListener('change', handleFilterChange);
}

function bindCheckout() {
  elements.placeOrder.addEventListener('click', handlePlaceOrder);
  elements.goToTracking.addEventListener('click', () => {
    switchView('tracking-view');
  });
}

function bindTrackingControls() {
  elements.resetTracking.addEventListener('click', () => {
    resetTracking();
    startTracking();
  });
}

function switchView(targetId) {
  state.activeView = targetId;
  elements.views.forEach((section) => {
    const isTarget = section.id === targetId;
    section.hidden = !isTarget;
    section.classList.toggle('active', isTarget);
  });

  elements.navButtons.forEach((button) => {
    button.classList.toggle('active', button.dataset.target === targetId);
  });

  window.requestAnimationFrame(() => {
    elements.app.focus();
  });

  if (targetId === 'tracking-view' && state.orderPlaced) {
    startTracking();
  }
}

function handleFilterChange() {
  const query = elements.searchInput.value.trim().toLowerCase();
  const price = elements.priceFilter.value;
  const maxDistance = Number(elements.distanceFilter.value);
  const surplusOnly = elements.surplusToggle.checked;
  const deliveryOnly = elements.deliveryToggle.checked;

  const filtered = suppliers.filter((supplier) => {
    const matchesQuery = supplier.name.toLowerCase().includes(query) || supplier.location.toLowerCase().includes(query);
    const matchesPrice = price === 'all' || supplier.price === price;
    const matchesDistance = supplier.distance <= maxDistance;
    const matchesSurplus = !surplusOnly || supplier.surplus;
    const matchesDelivery = !deliveryOnly || supplier.delivery;
    return matchesQuery && matchesPrice && matchesDistance && matchesSurplus && matchesDelivery;
  });

  renderSuppliers(filtered);
}

function renderSupplierFilters() {
  elements.distanceOutput.textContent = `${elements.distanceFilter.value} km`;
}

function renderSuppliers(list) {
  if (!elements.supplierGrid) {
    return;
  }

  if (list.length === 0) {
    elements.supplierGrid.innerHTML = '<p class="empty-state">No suppliers match your filters. Try widening the distance or price band.</p>';
    return;
  }

  const markup = list
    .map((supplier) => {
      const badge = supplier.surplus ? '<span class="badge">Surplus rescue</span>' : '';
      const deliveryText = supplier.delivery ? 'Delivery available' : 'Pickup only';
      const compareLabel = 'Compare supplier';
      const item = supplier.items[0];
      return `
        <article class="supplier-card" data-supplier="${supplier.id}">
          <div class="supplier-header">
            <div>
              <h3 class="supplier-name">${supplier.name}</h3>
              <p class="supplier-location">${supplier.location}</p>
            </div>
            ${badge}
          </div>
          <p>${supplier.description}</p>
          <div class="supplier-meta">
            <span>Price band: ${supplier.price}</span>
            <span>${supplier.distance} km away</span>
            <span>Freshness score: ${supplier.freshness}/10</span>
            <span>Delivery CO2: ${supplier.co2} kg</span>
          </div>
          <div class="hamper-summary">
            <h4>${item.name}</h4>
            <p>${item.notes}</p>
            <p><strong>$${item.price.toFixed(2)}</strong> &middot; Feeds ${item.servings} &middot; Saves $${item.savings.toFixed(2)}</p>
          </div>
          <div class="action-row">
            <button class="primary-btn" data-action="add-cart" data-supplier="${supplier.id}" data-item="${item.id}">Add hamper to cart</button>
            <button class="secondary-btn" data-action="compare" data-supplier="${supplier.id}">${compareLabel}</button>
          </div>
          <p class="supplier-footnote">${deliveryText}</p>
        </article>
      `;
    })
    .join('');

  elements.supplierGrid.innerHTML = markup;

  elements.supplierGrid.querySelectorAll('[data-action="add-cart"]').forEach((button) => {
    button.addEventListener('click', (event) => {
      const supplierId = event.currentTarget.dataset.supplier;
      const itemId = event.currentTarget.dataset.item;
      addToCart(supplierId, itemId);
    });
  });

  elements.supplierGrid.querySelectorAll('[data-action="compare"]').forEach((button) => {
    button.addEventListener('click', (event) => {
      const supplierId = event.currentTarget.dataset.supplier;
      prepareComparison(supplierId);
    });
  });
}

function addToCart(supplierId, itemId) {
  const supplier = suppliers.find((entry) => entry.id === supplierId);
  const item = supplier?.items.find((entry) => entry.id === itemId);
  if (!supplier || !item) {
    return;
  }

  state.cart.push({
    supplierId,
    itemId,
    supplierName: supplier.name,
    price: item.price,
    servings: item.servings,
    savings: item.savings,
    co2Saved: item.co2Saved,
    meals: item.meals
  });

  updateCartUI();
  switchView('checkout-view');
  elements.orderStatus.textContent = 'Hamper added. Review the details, then place your order.';
}

function updateCartUI() {
  const total = state.cart.reduce((sum, entry) => sum + entry.price, 0);
  if (state.cart.length === 0) {
    elements.cartList.innerHTML = '';
    elements.cartEmpty.hidden = false;
    elements.placeOrder.disabled = true;
    state.orderPlaced = false;
    elements.goToTracking.hidden = true;
    elements.orderStatus.textContent = '';
  } else {
    const markup = state.cart
      .map((entry, index) => {
        return `
          <li class="cart-item">
            <div class="cart-item-info">
              <strong>${entry.supplierName}</strong>
              <span>${entry.servings} servings &middot; Saves $${entry.savings.toFixed(2)} &middot; CO2 avoided ${entry.co2Saved.toFixed(1)} kg</span>
            </div>
            <div class="cart-item-actions">
              <span>$${entry.price.toFixed(2)}</span>
              <button class="ghost-btn" type="button" aria-label="Remove hamper" data-index="${index}">Remove</button>
            </div>
          </li>
        `;
      })
      .join('');

    elements.cartList.innerHTML = markup;
    elements.cartEmpty.hidden = true;
    elements.placeOrder.disabled = false;

    elements.cartList.querySelectorAll('[data-index]').forEach((button) => {
      button.addEventListener('click', (event) => {
        const itemIndex = Number(event.currentTarget.dataset.index);
        removeCartItem(itemIndex);
      });
    });
  }

  elements.cartTotal.textContent = `$${total.toFixed(2)}`;
  state.totals.savings = state.cart.reduce((sum, entry) => sum + entry.savings, 0);
  state.totals.co2Saved = state.cart.reduce((sum, entry) => sum + entry.co2Saved, 0);
  state.totals.meals = state.cart.reduce((sum, entry) => sum + entry.meals, 0);
  updateReport();
}

function removeCartItem(index) {
  state.cart.splice(index, 1);
  updateCartUI();
}

function handlePlaceOrder() {
  if (state.cart.length === 0) {
    return;
  }

  state.orderPlaced = true;
  elements.orderStatus.textContent = 'Order placed! Tracking has started with a shared EV route.';
  elements.goToTracking.hidden = false;
  elements.placeOrder.disabled = true;
}

function populateComparisonSelectors() {
  const options = suppliers
    .map((supplier) => `<option value="${supplier.id}">${supplier.name}</option>`)
    .join('');
  elements.compareA.innerHTML = options;
  elements.compareB.innerHTML = options;
  elements.compareA.selectedIndex = 0;
  elements.compareB.selectedIndex = 1;

  elements.compareA.addEventListener('change', updateComparison);
  elements.compareB.addEventListener('change', updateComparison);
}

function prepareComparison(supplierId) {
  const currentA = elements.compareA.value;
  const currentB = elements.compareB.value;

  if (supplierId === currentA || supplierId === currentB) {
    switchView('compare-view');
    updateComparison();
    return;
  }

  elements.compareB.value = supplierId;

  switchView('compare-view');
  updateComparison();
}

function updateComparison() {
  const supplierA = suppliers.find((entry) => entry.id === elements.compareA.value) || suppliers[0];
  const supplierB = suppliers.find((entry) => entry.id === elements.compareB.value) || suppliers[1];

  elements.compareNameA.textContent = supplierA.name;
  elements.compareNameB.textContent = supplierB.name;

  elements.compareMetrics.priceA.textContent = `${supplierA.price} (avg $${supplierA.averageBasket.toFixed(2)})`;
  elements.compareMetrics.priceB.textContent = `${supplierB.price} (avg $${supplierB.averageBasket.toFixed(2)})`;
  elements.compareMetrics.freshnessA.textContent = `${supplierA.freshness}/10`;
  elements.compareMetrics.freshnessB.textContent = `${supplierB.freshness}/10`;
  elements.compareMetrics.co2A.textContent = `${supplierA.co2} kg`;
  elements.compareMetrics.co2B.textContent = `${supplierB.co2} kg`;
  elements.compareMetrics.distanceA.textContent = `${supplierA.distance} km`;
  elements.compareMetrics.distanceB.textContent = `${supplierB.distance} km`;
  elements.compareMetrics.surplusA.textContent = supplierA.surplus ? 'Yes' : 'No';
  elements.compareMetrics.surplusB.textContent = supplierB.surplus ? 'Yes' : 'No';
}

function startTracking() {
  resetTracking();
  state.trackingIndex = 0;
  updateTrackingUI();
  state.trackingTimer = window.setInterval(() => {
    state.trackingIndex += 1;
    if (state.trackingIndex >= trackingStages.length) {
      clearInterval(state.trackingTimer);
      state.trackingTimer = null;
      state.trackingIndex = trackingStages.length - 1;
    }
    updateTrackingUI();
  }, 3000);
}

function resetTracking() {
  if (state.trackingTimer) {
    clearInterval(state.trackingTimer);
    state.trackingTimer = null;
  }
  state.trackingIndex = 0;
  updateTrackingUI();
}

function renderTrackingSteps() {
  const markup = trackingStages
    .map((stage) => {
      return `
        <li class="tracking-step" data-stage="${stage.id}">
          <span>${stage.title}</span>
          <span class="tracking-detail">${stage.detail}</span>
        </li>
      `;
    })
    .join('');
  elements.trackingSteps.innerHTML = markup;
}

function updateTrackingUI() {
  const steps = Array.from(elements.trackingSteps.querySelectorAll('.tracking-step'));
  steps.forEach((step, index) => {
    step.classList.toggle('active', index <= state.trackingIndex);
  });

  const progress = (state.trackingIndex / (trackingStages.length - 1)) * 100;
  elements.progressIndicator.style.width = `${progress}%`;
}

function updateReport() {
  elements.reportSavings.textContent = `$${state.totals.savings.toFixed(2)}`;
  elements.reportCo2.textContent = `${state.totals.co2Saved.toFixed(1)} kg`;
  elements.reportMeals.textContent = `${state.totals.meals}`;
}

</script>
  </body>
</html>
